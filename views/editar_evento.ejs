<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Editar Evento</title>
    <link rel="stylesheet" href="../resources/css/style_editarEventos.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <h1>Editar Evento</h1>
        <form id="editarEventoForm" action="/api/eventos/<%= evento.id %>/actualizar" method="POST" enctype="multipart/form-data">
            <input type="hidden" id="eventoId" name="eventoId" value="<%= evento.id %>">
            <label for="titulo">Título:</label>
            <input type="text" id="titulo" name="titulo" value="<%= evento.titulo %>"><br>

            <label for="descripcion">Descripción:</label>
            <textarea id="descripcion" name="descripcion"><%= evento.descripcion %></textarea><br>

            <label for="numero_entradas">Número de Entradas:</label>
            <input type="number" id="numero_entradas" name="numero_entradas" value="<%= evento.numero_entradas %>"><br>

            <label for="localizacion">Localización:</label>
            <input type="text" id="localizacion" name="localizacion" value="<%= evento.localizacion %>"><br>

            <label for="precio">Precio:</label>
            <input type="number" id="precio" name="precio" value="<%= evento.precio %>"><br>

            <label for="deporte">Deporte:</label>
            <input type="text" id="deporte" name="deporte" value="<%= evento.deporte %>"><br>

            <label for="fecha_inicio">Fecha de inicio:</label>
            <input type="date" id="fecha_inicio" name="fecha_inicio" value="<%= evento.fecha_inicio %>"><br>

            <label for="fecha_fin">Fecha de fin:</label>
            <input type="date" id="fecha_fin" name="fecha_fin" value="<%= evento.fecha_fin %>"><br>

            <!-- Contenedor para campos específicos de la categoría -->
            <div id="categoriaCampos"></div>

            <!-- Mostrar imágenes existentes -->
            <div id="fotosExistentes">
                <h4>Fotos Existentes:</h4>
                <% if (evento.FotoEventos && evento.FotoEventos.length > 0) { %>
                    <% evento.FotoEventos.forEach(function(foto) { %>
                        <div class="foto-item">
                            <img src="<%= foto.url %>" alt="<%= foto.descripcion %>" width="100">
                            <input type="checkbox" name="fotosEliminadas" value="<%= foto.foto_id %>"> Eliminar
                        </div>
                    <% }); %>
                <% } %>
            </div>

            <!-- Carga de fotos nuevas -->
            <label for="fotos">Subir Fotos Nuevas:</label>
            <input type="file" id="fotos" name="fotos" multiple><br>

            <button type="submit">Guardar Cambios</button>
        </form>
    </div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
        function cargarCamposCategoria() {
            var categoria = "<%= categoria %>";
            var camposCategoria = document.getElementById('categoriaCampos');
            camposCategoria.innerHTML = '';

            switch (categoria) {
                case 'clase':
                    camposCategoria.innerHTML += `
                        <div><label>Instructor:</label><input type="text" name="instructor" value="<%= evento.EventoClase ? evento.EventoClase.instructor : '' %>"></div>
                        <div><label>Duración:</label><input type="text" name="duracion" value="<%= evento.EventoClase ? evento.EventoClase.duracion : '' %>"></div>
                        <div><label>Nivel:</label><input type="text" name="nivel" value="<%= evento.EventoClase ? evento.EventoClase.nivel : '' %>"></div>`;
                    break;
                case 'partido':
                    camposCategoria.innerHTML += `
                        <div><label>Equipo Local:</label><input type="text" name="equipo_local" value="<%= evento.EventoPartido ? evento.EventoPartido.equipo_local : '' %>"></div>
                        <div><label>Equipo Visitante:</label><input type="text" name="equipo_visitante" value="<%= evento.EventoPartido ? evento.EventoPartido.equipo_visitante : '' %>"></div>
                        <div><label>Liga:</label><input type="text" name="liga" value="<%= evento.EventoPartido ? evento.EventoPartido.liga : '' %>"></div>`;
                    break;
                case 'campus':
                    camposCategoria.innerHTML += `
                        <div><label>Programa:</label><input type="text" name="programa" value="<%= evento.EventoCampus ? evento.EventoCampus.programa : '' %>"></div>`;
                    break;
                case 'ocasion':
                    camposCategoria.innerHTML += `
                        <div><label>Tipo de Ocasion:</label><input type="text" name="tipo_ocasion" value="<%= evento.EventoOcasion ? evento.EventoOcasion.tipo_ocasion : '' %>"></div>`;
                    break;
            }
        }

        window.onload = cargarCamposCategoria;

        // Captura el evento de submit del formulario para manipular fotosEliminadas
        $('#editarEventoForm').on('submit', function() {
            var fotosEliminadas = [];
            $('input[name="fotosEliminadas"]:checked').each(function() {
                fotosEliminadas.push($(this).val());
            });
            $('<input>').attr({
                type: 'hidden',
                name: 'fotosEliminadas',
                value: fotosEliminadas.join(',')
            }).appendTo('#editarEventoForm');
        });
    </script>
</body>
</html>
