<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Eventos</title>
    <link rel="stylesheet" href="../resources/css/styleEmp.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
</head>
<body>
    <div class="container mt-4">
        <h1>Eventos</h1>
        <table class="table table-striped">
            <thead>
                <tr>
                    <th scope="col">#</th>
                    <th scope="col">Título</th>
                    <th scope="col">Descripción</th>
                    <th scope="col">Número de Entradas</th>
                    <th scope="col">Localización</th>
                    <th scope="col">Precio</th>
                    <th scope="col">Acción</th>
                </tr>
            </thead>
            <tbody id="tablaEventos">
                <!-- Aquí se cargarán los datos de los eventos -->
            </tbody>
        </table>
        
        <a href="/crear_evento" class="create-event-button">
            <i class='bx bxs-eraser'></i>Crear Evento
        </a>
    </div>

    <!-- Agregar el script jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
        $(document).ready(function(){
            // Hacer la solicitud AJAX para obtener los datos de los eventos
            $.ajax({
                url: '/api/mostrar_evento', // Cambia la URL aquí
                method: 'GET',
                success: function(response){
                    // Iterar sobre los eventos recibidos y agregarlos a la tabla
                    response.forEach(function(evento, index){
                        $('#tablaEventos').append(`
                            <tr>
                                <th scope="row">${index + 1}</th>
                                <td>${evento.titulo}</td>
                                <td>${evento.descripcion}</td>
                                <td>${evento.numero_entradas}</td>
                                <td>${evento.localizacion}</td>
                                <td>${evento.precio}</td>
                                <td>
                                    <div class="btn-group" role="group" aria-label="Acciones">
                                        <a href="#" class="create-event-button delete-event-button" data-id="${evento.id}">
                                            <i class='bx bxs-eraser'></i>Eliminar
                                        </a>
                                        <a href="#" class="create-event-button edit-event-button" data-id="${evento.id}">
                                            <i class='bx bxs-edit'></i>Editar
                                        </a>
                                        <a href="#" class="create-event-button info-event-button" data-id="${evento.id}">
                                            <i class='bx bx-info-circle'></i>Información
                                        </a>
                                    </div>
                                </td>
                            </tr>
                        `);
                    });
                },
                error: function(error){
                    console.error('Error al obtener los eventos:', error);
                    alert('Hubo un error al obtener los eventos. Por favor, inténtalo de nuevo más tarde.');
                }
            });

            // Controlador de eventos de clic en el botón de eliminar
            $(document).on('click', '.delete-event-button', function(e){
                e.preventDefault(); // Evita que el enlace se comporte como un enlace normal
                var eventId = $(this).data('id');
                console.log('Clic en botón de eliminar detectado para el evento ID:', eventId);

                // Eliminar la fila correspondiente de la tabla
                $(this).closest('tr').remove();

                // Hacer la solicitud AJAX para eliminar el evento
                $.ajax({
                    url: '/api/eliminar_evento?id=' + eventId,
                    method: 'GET',
                    success: function(response){
                        console.log('Evento eliminado de la base de datos:', response);
                    },
                    error: function(error){
                        console.error('Error al eliminar el evento:', error);
                        alert('Hubo un error al eliminar el evento. Por favor, inténtalo de nuevo más tarde.');
                    }
                });
            });

            // Controlador de eventos de clic en el botón de editar
            $(document).on('click', '.edit-event-button', function(e){
            e.preventDefault(); // Evita que el enlace se comporte como un enlace normal
            var eventId = $(this).data('id');
            console.log('Clic en botón de editar detectado para el evento ID:', eventId);

             // Redirigir a la página de edición del evento con el ID como parámetro en la URL
                window.location.href = '/editar_evento?id=' + eventId;
            });


           // Controlador de eventos de clic en el botón de información
            $(document).on('click', '.info-event-button', function(e){
            e.preventDefault(); // Evita que el enlace se comporte como un enlace normal
            var eventId = $(this).data('id');
            console.log('Clic en botón de información detectado para el evento ID:', eventId);

            // Redirigir a la página de información del evento con el ID como parámetro en la URL
            window.location.href = '/informacion_evento?id=' + eventId;
            });

        });
    </script>
</body>
</html>
